var three = require("three");
require("extensions/math");


function generateBend(position, orientation, angleOffest, maxX = 0.2) {
	var matrixRot = new three.Matrix4();
	matrixRot.makeRotationFromEuler(orientation);
	var matrixPos = new three.Matrix4();
	matrixPos.makeTranslation(position.x, position.y, position.z);
	var matrix = matrixPos.premultiply(matrixRot);
	var matrixInv = new three.Matrix4().getInverse(matrix);
	return function bendVertex(vertex) {
		vertex.applyMatrix4(matrix);
		var amt = Math.clamp01(vertex.x / maxX, 0, 1);
		var angle = Math.atan2(vertex.y, vertex.x) + angleOffest * amt;
		var dist = Math.sqrt(vertex.y*vertex.y + vertex.x*vertex.x);
		vertex.x = Math.cos(angle) * dist;
		vertex.y = Math.sin(angle) * dist;
		vertex.applyMatrix4(matrixInv);
	};
}

module.exports = generateBend;